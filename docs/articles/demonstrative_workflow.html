<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demonstrative workflow • docker4seq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Demonstrative workflow">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">docker4seq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/docker4seq.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demonstrative_workflow.html">Demonstrative workflow</a>
    </li>
    <li>
      <a href="../articles/rsconnect/documents/casc.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/rsconnect/documents/demonstrative_workflow.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/rsconnect/documents/docker4seq.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/rsconnect/documents/skeleton.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/rsconnect/documents/supplementary_data.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/skeleton.html">Skeleton tutorial</a>
    </li>
    <li>
      <a href="../articles/supplementary_data.html"> Supplementary data SeqBox: RNAseq/ChIPseq reproducible analysis on a consumer game computer</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Demonstrative workflow</h1>
            
            <h4 class="date">02/16/2018</h4>
      
      
      <div class="hidden name"><code>demonstrative_workflow.Rmd</code></div>

    </div>

    
    


<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The docker4seq package is an R control engine, which is at the core of the SeqBox ecosystem. It was developed to facilitate the use of computing demanding applications in the field of NGS data analysis.</p>
<p>The docker4seq package uses <a href="https://www.docker.com/what-docker">docker</a> <a href="https://www.docker.com/what-container">containers</a> that embed demanding computing tasks (e.g. short reads mapping) into isolated docker images.</p>
<p>This approach provides multiple advantages:</p>
<ul>
<li><p>user does not need to install all the software on its local server;</p></li>
<li><p>docker images can be organized in pipelines;</p></li>
<li><p>reproducible research is guarantee by the possibility of sharing the docker images used for the analysis.</p></li>
</ul>
<p><strong>MANDATORY:</strong> The first time <em>docker4seq</em> is installed the <strong>downloadContainers</strong> function has to be executed to download, in the local repository, the docker images that are needed by <em>docker4seq</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/downloadContainers.html">downloadContainers</a></span>(<span class="dt">group=</span><span class="st">"docker"</span>)</code></pre></div>
</div>
<div id="rnaseq-workflow-howto" class="section level2">
<h2 class="hasAnchor">
<a href="#rnaseq-workflow-howto" class="anchor"></a>RNAseq workflow: Howto</h2>
<p>The mRNAseq workflow can be run using <strong>4SeqGUI</strong> graphical interface (linux):</p>
<div class="figure">
<img src="../inst/img/rnaseq1.jpeg" alt="mRNAseq workflow"><p class="caption">mRNAseq workflow</p>
</div>
<p>Sample quantification is made of these steps:</p>
<ul>
<li><p>Creating a genome index for STAR (see end of this paragraph)</p></li>
<li><p>Running removing sequencing adapters</p></li>
<li><p>Mapping reads to the reference genome</p></li>
<li><p>Quantify gene and transcript expression level</p></li>
<li><p>Annotating genes.</p></li>
</ul>
<p>All the parameters can be setup using 4SeqGUI</p>

<div id="creating-a-star-index-file-for-mrnaseq" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-star-index-file-for-mrnaseq" class="anchor"></a>Creating a STAR index file for mRNAseq:</h3>
<p>The index can be easily created using the graphical interface:</p>
<div class="figure">
<img src="../inst/img/rnaseq2.jpeg" alt="Creating a STAR genome index"><p class="caption">Creating a STAR genome index</p>
</div>
<p>A detailed description of the parameters is given hereafter.</p>
<div id="creating-a-star-index-file-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#creating-a-star-index-file-by-line-command" class="anchor"></a>Creating a STAR index file by line command</h4>
<p></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/rsemstarIndex.html">rsemstarIndex</a></span>(<span class="dt">group=</span><span class="st">"docker"</span>,<span class="dt">genome.folder=</span><span class="st">"/data/scratch/hg38star"</span>,
<span class="dt">ensembl.urlgenome=</span><span class="st">"ftp://ftp.ensembl.org/pub/release-87/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.toplevel.fa.gz"</span>,
<span class="dt">ensembl.urlgtf=</span><span class="st">"ftp://ftp.ensembl.org/pub/release-87/gtf/homo_sapiens/Homo_sapiens.GRCh38.87.gtf.gz"</span>)</code></pre></div>
<p>In brief, <strong>rsemstarIndex</strong> uses ENSEMBL genomic data. User has to provide the URL (<strong>ensembl.urlgenome</strong>) for the file XXXXX_dna.toplevel.fa.gz related to the organism of interest, the URL (<strong>ensembl.urlgtf</strong>) for the annotation GTF XXX.gtf.gz and the path to the folder where the index will be generated (<strong>genome.folder</strong>). The parameter <strong>threads</strong> indicate the number of cores dedicated to this task.</p>
<p>Precompiled index folders are available:</p>
<ul>
<li><p><a href="http://130.192.119.59/public/hg38star.tar.gz">hg38star</a></p></li>
<li><p><a href="http://130.192.119.59/public/mm10star.tar.gz">mm10star</a></p></li>
</ul>
</div>
</div>
<div id="quantifying-genesisoforms" class="section level3">
<h3 class="hasAnchor">
<a href="#quantifying-genesisoforms" class="anchor"></a>Quantifying genes/isoforms:</h3>
<div class="figure">
<img src="../inst/img/rnaseq3.jpeg" alt="Gene, Isoform counting"><p class="caption">Gene, Isoform counting</p>
</div>
<p>A detailed description of the parameters is given below.</p>
<div id="sample-quantification-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#sample-quantification-by-line-command" class="anchor"></a>Sample quantification by line command</h4>
<p>The sample quantification can be also executed using R and it is completely embedded in a single function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget http://130.192.119.59/public/test.mrnaCounts.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.mrnaCounts.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"./test.mrnaCounts"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/rnaseqCounts.html">rnaseqCounts</a></span>(<span class="dt">group=</span><span class="st">"docker"</span>,<span class="dt">fastq.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(), <span class="dt">scratch.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(),
<span class="dt">adapter5=</span><span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,
<span class="dt">adapter3=</span><span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,
<span class="dt">seq.type=</span><span class="st">"se"</span>, <span class="dt">threads=</span><span class="dv">8</span>,  <span class="dt">min.length=</span><span class="dv">40</span>,
<span class="dt">genome.folder=</span><span class="st">"/data/scratch/mm10star"</span>, <span class="dt">strandness=</span><span class="st">"none"</span>, <span class="dt">save.bam=</span><span class="ot">FALSE</span>,
<span class="dt">org=</span><span class="st">"mm10"</span>, <span class="dt">annotation.type=</span><span class="st">"gtfENSEMBL"</span>)</code></pre></div>
<p>User needs to create the <strong>fastq.folder</strong>, where the fastq.gz file(s) for the sample under analysis are located. The <strong>scratch.folder</strong> is the location where temporary data are created. The results will be then saved in the <strong>fastq.folder</strong>.</p>
<p>User needs to provide also the sequence of the sequencing adapters, <strong>adapter5</strong> and <strong>adapter3</strong> parameters.</p>
<p><strong>seq.type</strong> indicates if single-end (se) or pair-end (pe) data are provided, <strong>threads</strong> indicates the max number of cores used by <em>skewer</em> and <em>STAR</em>, all the other steps are done on a single core.</p>
<p>The <strong>min.length</strong> refers to the minimal length that reads should have after adapters trimming. Since today the average read length for a RNAseq experiment is 50 or 75 nts then it would be better to bring to 40 nts the min.length parameter to increase the precision in assigning the correct position on the genome.</p>
<p>The <strong>genome.folder</strong> parameter refers to the location of the genomic index generated by STAR using the <em>docker4seq</em> function <strong>rsemstarIndex</strong>, see above paragraph.</p>
<p><strong>strandness</strong>, is a parameter referring to the kit used for the library prep. If the kit does not provide strand information it is set to “none”, if provides strand information is set to “forward” for Illumina stranded kit and it set to “reverse” for Illumina ACCESS kit. <strong>save.bam</strong> set to TRUE indicates that genomic bam file and transcriotomic bam files are also saved at the end of the analysis. <strong>annotation.type</strong> refers to the type of available gene-level annotation. At the present time is only available ENSEMBL annotation defined by the gtf downloaded during the creation of the indexed genome files, see paragraph <em>at the end</em>Creating a STAR index file for mRNAseq*.</p>
</div>
</div>
<div id="sample-quantification-output-files" class="section level3">
<h3 class="hasAnchor">
<a href="#sample-quantification-output-files" class="anchor"></a>Sample quantification output files</h3>
<p>The mRNAseq workflow produces the following output files:</p>
<pre><code>+ XXXXX-trimmed.log, containing the information related to the adapters trimming
+ gtf_annotated_genes.results, the output of RSEM gene quantification with gene-level annotation
+ Log.final.out, the statistics of the genome mapping generated by STAR  
+ rsem.info, summary of the parameters used in the run
+ genes.results, the output of RSEM gene quantification
+ isoforms.results, the output of RSEM isoform quantification
+ run.info, some statistics on the run
+ skewerd_xxxxxxxxxxxx.log, log of the skewer docker container
+ stard.yyyyyyyyyyyy.log, log of the star docker container</code></pre>
<div class="figure">
<img src="../inst/img/rnaseq7.jpeg" alt="gtf_annotated_genes.results"><p class="caption">gtf_annotated_genes.results</p>
</div>
<p>The first column in <strong>gtf_annotated_genes.results</strong> is the ensembl gene id, the second column is the <a href="http://www.ensembl.org/Help/Faq?id=468">biotype</a>, the third column is the annotation source, the fourth column contains the set of transcripts included in the ensembl gene id. Then there is the length of the gene, the length of the gene to which is subtracted the average length of the sequenced fragments, the expected counts are the counts to be used for differential expression analysis. <a href="https://haroldpimentel.wordpress.com/2014/05/08/what-the-fpkm-a-review-rna-seq-expression-units/">TPM</a> and <a href="https://haroldpimentel.wordpress.com/2014/05/08/what-the-fpkm-a-review-rna-seq-expression-units/">FPM</a> are normalized gene quantities to be used only for visualization purposes.</p>
</div>
<div id="alignment-dependent-tools-versus-aligner-free-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#alignment-dependent-tools-versus-aligner-free-methods" class="anchor"></a>Alignment-dependent tools versus aligner-free methods</h3>
<p>Recently Zhang and coworkers (BMC Genomics 2017, 18,583) compared, at transcript level, alignment-dependent tools (Salmon_aln, eXpress, RSEM and TIGAR2) and aligner-free methods (Salmon, Kallisto Sailfish). In their paper, STAR was used as mapping tool for all alignment-dependent tools. In terms of isoform quantification, the authors indicated that there is strong concordance among quantification results from RSEM, Salmon, Salmon_aln, Kallisto and Sailfish (R2 &gt; 0.89), suggesting that the impact of mappers on isoform quantification is small. Furthermore, the paper of Teng and coworkers (Genome Biology 2016, 17,74) reported that,in term of gene-level quantification, differences between alignment-dependent tools and aligner-free methods are shrinking with respect to transcripts level analysis. On the basis of the above papers it seems that from the quantification point of view the difference between alignment free and alignment-dependent tools is very limited. However, aligner-free methods have low memory requirements and we have added Salmon in the development version of docker4seq in github. We are planning to introduce Salmon in the stable version of docker4seq in the first quarter of 2018. Salmon implementation will allow to increase the sample throughput, by running multiple samples. Currently samples are run serially because of the high RAM requirement of STAR.</p>
</div>
<div id="from-samples-to-experiment" class="section level3">
<h3 class="hasAnchor">
<a href="#from-samples-to-experiment" class="anchor"></a>From samples to experiment</h3>
<p>The RSEM output is sample specific, thus it is necessary to assemble the single sample in an experiment table including in the header of the columns both the covariates and the batches, if any. The header sample name is separated by the covariate with an underscore, e.g. mysample1_Cov1, mysample2_Cov2.</p>
<div class="figure">
<img src="../inst/img/counts1.jpeg" alt="counts table with covariates"><p class="caption">counts table with covariates</p>
</div>
<p>A batch can be added to the sample name through a further underscore, e.g. mysample1_Cov1_batch1, mysample2_Cov_batch2.</p>
<div class="figure">
<img src="../inst/img/counts2.jpeg" alt="counts table with covariates and batch"><p class="caption">counts table with covariates and batch</p>
</div>
<p>The addition of the covariates to the various samples can be done using the <strong>4seqGUI</strong> using the button: <em>From samples to experiment</em>.</p>
<div class="figure">
<img src="../inst/img/counts3.jpeg" alt="generating a table with covariates"><p class="caption">generating a table with covariates</p>
</div>
<div id="from-samples-to-experiments-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#from-samples-to-experiments-by-line-command" class="anchor"></a>From samples to experiments by line command</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget http://130.192.119.59/public/test.samples2experiment.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.samples2experiment.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.samples2experiment"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/sample2experiment.html">sample2experiment</a></span>(<span class="dt">sample.folders=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"./e1g"</span>,<span class="st">"./e2g"</span>,<span class="st">"./e3g"</span>,
<span class="st">"./p1g"</span>, <span class="st">"./p2g"</span>, <span class="st">"./p3g"</span>),
<span class="dt">covariates=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Cov.1"</span>,<span class="st">"Cov.1"</span>,<span class="st">"Cov.1"</span>,<span class="st">"Cov.2"</span>,<span class="st">"Cov.2"</span>,<span class="st">"Cov.2"</span>),
<span class="dt">bio.type=</span><span class="st">"protein_coding"</span>, <span class="dt">output.prefix=</span><span class="st">"."</span>)</code></pre></div>
<p>User needs to provide the paths of the samples, <strong>sample.folder</strong> parameter, a vector of the covariates, <strong>covariates</strong>, and the biotype(s) of interest, <strong>bio.type</strong> parameter. The parameter <strong>output.prefix</strong> refers to the path where the output will be created, as default this is the current R working folder.</p>
</div>
<div id="from-samples-to-experiments-output-files" class="section level4">
<h4 class="hasAnchor">
<a href="#from-samples-to-experiments-output-files" class="anchor"></a>From samples to experiments output files</h4>
<p>This task produces the following output files:</p>
<pre><code>+ _counts.txt: gene-level raw counts table for differential expression analysis
+ _isoforms_counts.txt: isoform-level raw counts table for differential expression analysis
+ _isoforms_log2TPM.txt: isoform-level log2TPM for visualization purposes
+ _log2TPM.txt: gene-level log2TPM for visualization purposes
+ _isoforms_log2FPKM.txt: isoform-level log2FPKM for visualization purposes
+ _log2FPKM.txt: gene-level log2FPKM for visualization purposes
+ XXXXX.Rout: logs of the execution</code></pre>
</div>
</div>
<div id="visualizing-experiment-data-with-pca" class="section level3">
<h3 class="hasAnchor">
<a href="#visualizing-experiment-data-with-pca" class="anchor"></a>Visualizing experiment data with PCA</h3>
<p><a href="https://georgemdallas.wordpress.com/2013/10/30/principal-component-analysis-4-dummies-eigenvectors-eigenvalues-and-dimension-reduction/">PCA</a> is a statistical procedure that uses an orthogonal transformation to convert a set of observations of possibly correlated variables into a set of values of linearly uncorrelated variables called principal components. This transformation is defined in such a way that the first principal component accounts for as much of the variability in the data as possible, and each succeeding component in turn has the highest variance possible under the constraint that it is orthogonal to the preceding components. <strong>4SeqGUI</strong> provides an interface to the generation experiment samples PCA</p>
<div class="figure">
<img src="../inst/img/pca1.jpeg" alt="PCA"><p class="caption">PCA</p>
</div>
<p>The plot is saved in <strong>pca.pdf</strong> in the selected folder.</p>
<div id="pca-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#pca-by-line-command" class="anchor"></a>PCA by line command</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.analysis"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/pca.html">pca</a></span>(<span class="dt">experiment.table=</span><span class="st">"_log2FPKM.txt"</span>, <span class="dt">type=</span><span class="st">"FPKM"</span>, <span class="dt">legend.position=</span><span class="st">"topleft"</span>, 
    <span class="dt">covariatesInNames=</span><span class="ot">FALSE</span>, <span class="dt">principal.components=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">pdf =</span> <span class="ot">TRUE</span>, <span class="dt">output.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>())</code></pre></div>
<p>User needs to provide the paths of experiment table, <strong>experiment.table</strong> parameter, i.e. the file generated using the samples2experiment function. The <strong>type</strong> parameter indicates if FPKM, TPM or counts are used by the PCA generation. The parameter <strong>legend.position</strong> defines where to locate the covariates legend. The parameter <strong>covariatesInNames</strong> indicates if the header of the experiment table contains or not covariate information. The parameter <strong>principal.components</strong> indicates which principal components should be plotted. <strong>output.folder</strong> indicates where to save the pca.pdf file.</p>
<div class="figure">
<img src="../inst/img/pca2.jpeg" alt="pca.pdf"><p class="caption">pca.pdf</p>
</div>
<p>The values in parentesis on x and y axes are the amount of variance explained by each principal component.</p>
<p>IMPORTANT: The above analysis is suitable for miRNAseq data too.</p>
</div>
</div>
<div id="evaluating-sample-size-and-experiment-power" class="section level3">
<h3 class="hasAnchor">
<a href="#evaluating-sample-size-and-experiment-power" class="anchor"></a>Evaluating sample size and experiment power</h3>
<p>Sample size estimation is an important issue in the design of RNA sequencing experiments. Furthermore, experiment power provides an indication of which is the fraction of differentially expressed genes that can be detected given a specific number of samples and differential expression detection thresholds. <a href="https://www.ncbi.nlm.nih.gov/pubmed/25246651">RnaSeqSampleSize</a> Bioconductor package provides the possibility to calculate, from a pilot experiment, the statistical power and to define the optimal sample size. We have implemented wrapper functions to call these RnaSeqSampleSize functions for the sample size estimation and for statistical power estimation.</p>
<p><strong>4SeqGUI</strong> provides an interface to sample size estimation and to statistical power estimation.</p>
<div class="figure">
<img src="../inst/img/ss.jpeg" alt="sample size estimation"><p class="caption">sample size estimation</p>
</div>
<div class="figure">
<img src="../inst/img/es.jpeg" alt="stat power estimation"><p class="caption">stat power estimation</p>
</div>
<div id="sample-size-estimation-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#sample-size-estimation-by-line-command" class="anchor"></a>Sample size estimation by line command</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.analysis"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/sampleSize.html">sampleSize</a></span>(<span class="dt">group=</span><span class="st">"docker"</span>, <span class="dt">filename=</span><span class="st">"_counts.txt"</span>, <span class="dt">power=</span><span class="fl">0.80</span>, <span class="dt">FDR=</span><span class="fl">0.1</span>, <span class="dt">genes4dispersion=</span><span class="dv">200</span>, <span class="dt">log2fold.change=</span><span class="dv">1</span>)</code></pre></div>
<p>The requested parameters are the path of the counts experiment table generated by <strong>samples2experiment</strong> function. The param <strong>power</strong> indicates the expected fraction of differentially expressed gene, e.g 0.80. <strong>FDR</strong> and <strong>log2fold.change</strong> are the two thresholds used to define the set of differentially expressed genes of interest.</p>
<p>The output file is <strong>sample_size_evaluation.txt</strong> and it is saved in the R working folder, below an example of the file content:</p>
<div class="figure">
<img src="../inst/img/samplesize1.jpeg" alt="sample_size_evaluation.txt"><p class="caption">sample_size_evaluation.txt</p>
</div>
<p>IMPORTANT: The above analysis is suitable for miRNAseq data too.</p>
</div>
<div id="experiment-statistical-power-estimation-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#experiment-statistical-power-estimation-by-line-command" class="anchor"></a>Experiment statistical power estimation by line command</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.analysis"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/experimentPower.html">experimentPower</a></span>(<span class="dt">group=</span><span class="st">"docker"</span>, <span class="dt">filename=</span><span class="st">"_counts.txt"</span>,<span class="dt">replicatesXgroup=</span><span class="dv">7</span>, <span class="dt">FDR=</span><span class="fl">0.1</span>, <span class="dt">genes4dispersion=</span><span class="dv">200</span>, <span class="dt">log2fold.change=</span><span class="dv">1</span>)</code></pre></div>
<p>The requested parameters are the path of the counts experiment table generated by <strong>samples2experiment</strong> function. The param <strong>replicatesXgroup</strong> indicates the number of sample associated with each of the two covariates. <strong>FDR</strong> and <strong>log2fold.change</strong> are the two thresholds used to define the set of differentially expressed genes of interest. <strong>genes4dispersion</strong> indicates the number of genes used in the estimation of read counts and dispersion distribution.</p>
<p>The output file is <strong>power_estimation.txt</strong> and it is saved in the R working folder, below an example of the file content:</p>
<div class="figure">
<img src="../inst/img/expp1.jpeg" alt="power_estimation.txt"><p class="caption">power_estimation.txt</p>
</div>
<p>IMPORTANT: The above analysis is suitable for miRNAseq data too.</p>
</div>
</div>
<div id="differential-expression-analysis-with-deseq2" class="section level3">
<h3 class="hasAnchor">
<a href="#differential-expression-analysis-with-deseq2" class="anchor"></a>Differential expression analysis with DESeq2</h3>
<p>A basic task in the analysis of count data from RNA-seq is the detection of differentially expressed genes. <strong>4SeqGUI</strong> provides an interface to DESeq2 to simplify differential expression analysis.</p>
<div class="figure">
<img src="../inst/img/de1.jpeg" alt="DESeq2"><p class="caption">DESeq2</p>
</div>
<p>The output files are:</p>
<p><strong>DEfull.txt</strong> containing the full set of results generated by DESeq2</p>
<div class="figure">
<img src="../inst/img/de2.jpeg" alt="DEfull.txt"><p class="caption">DEfull.txt</p>
</div>
<p><strong>DEfiltered_log2fc_X_fdr_Y.Y.txt</strong> containing the set of differentially expressed genes passing the indicated thresholds</p>
<div class="figure">
<img src="../inst/img/de3.jpeg" alt="DEfiltered_log2fc_1_fdr_0.1.txt"><p class="caption">DEfiltered_log2fc_1_fdr_0.1.txt</p>
</div>
<p><strong>genes4david.txt</strong> a file containing only the gene symbols to be used as input for <a href="https://david.ncifcrf.gov/">DAVID</a> or <a href="http://amp.pharm.mssm.edu/Enrichr/">ENRICHR</a></p>
<p>log2normalized_counts.txt, log2 library size normalized counts, calculated by DESeq2, that can be used for visualization purposes.</p>
<div id="deseq2-by-line-command" class="section level4">
<h4 class="hasAnchor">
<a href="#deseq2-by-line-command" class="anchor"></a>DESeq2 by line command</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.analysis"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/wrapperDeseq2.html">wrapperDeseq2</a></span>(<span class="dt">output.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(), <span class="dt">group=</span><span class="st">"docker"</span>, 
      <span class="dt">experiment.table=</span><span class="st">"_counts.txt"</span>, <span class="dt">log2fc=</span><span class="dv">1</span>, <span class="dt">fdr=</span><span class="fl">0.1</span>, 
      <span class="dt">ref.covar=</span><span class="st">"Cov.1"</span>, <span class="dt">type=</span><span class="st">"gene"</span>, <span class="dt">batch=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>User has to provide experiment table, <strong>experiment.table</strong> param, i.e. the counts table generated with <strong>samples2experiment</strong> function, the thresholds for the differential expression analysis, <strong>log2fc</strong> and <strong>fdr</strong> params, the reference covariate, <strong>ref.covar</strong> param, i.e. the covariate that is used as reference for differential expression detection, the <strong>type</strong> param, which refers to the type of experiment table in use: <em>gene</em>, <em>isoform</em>, <em>mirna</em>, <strong>batch</strong> parameter that indicates, if it is set to <strong>TRUE</strong> that the header of the experiment table also contains the extra information for the batch effect (see above).</p>
<p>IMPORTANT: the above analysis can be applied to miRNAseq data too.</p>
</div>
<div id="why-deseq2-was-chosen-as-differential-expression-tool" class="section level4">
<h4 class="hasAnchor">
<a href="#why-deseq2-was-chosen-as-differential-expression-tool" class="anchor"></a>Why DESeq2 was chosen as differential expression tool</h4>
<p>Love and co-workers, in their paper on DESeq2 (Love at al. Genome Biol. 2014; 15, 550), showed that DESeq2 had comparable sensitivity to edgeR and voom. We introduced in our workflow DESeq2 because it has some specific features which increase the strength of the differential expression analysis, features that are not available in other tools. One of these features is, the Empirical Bayes shrinkage for fold-change estimation, which shrinks log fold change estimates toward zero. This feature reduces the noise due to low expressed genes, since shrinkage is stronger when the available information for a gene is low, which may be because the read counts are low, dispersion is high or there are few degrees of freedom. The other peculiar feature of DESeq2 is the identification of counts outliers, which might represent a source of false positives. Specifically, DESeq2 flags genes characterized by the presence of counts outliers, which are estimated with the standard outlier diagnostic Cook’s distance (Love at al. Genome Biol. 2014; 15, 550).</p>
</div>
</div>
</div>
<div id="mirnaseq-workflow-howto" class="section level2">
<h2 class="hasAnchor">
<a href="#mirnaseq-workflow-howto" class="anchor"></a>miRNAseq workflow: Howto</h2>
<p>The miRNAseq workflow can be run using <strong>4SeqGUI</strong> graphical interface:</p>
<div class="figure">
<img src="../inst/img/mirna1.jpeg" alt="miRNAseq workflow"><p class="caption">miRNAseq workflow</p>
</div>
<p>The miRNAseq docker container executes the following steps:</p>
<div class="figure">
<img src="../inst/img/mirna3.jpeg" alt="miRNAseq workflow"><p class="caption">miRNAseq workflow</p>
</div>
<p>The full workflow is described in <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0031630">Cordero et al. Plos ONE 2012</a>. In brief, fastq files are trimmed using <a href="https://github.com/marcelm/cutadapt">cutadapt</a> and the trimmed reads are mapped on miRNA precursors, i.e. harpin.fa file, from <a href="http://www.mirbase.org/ftp.shtml">miRBase</a> using <a href="http://compbio.cs.toronto.edu/shrimp/">SHRIMP</a>. Using the location of the mature miRNAs in the precursor, countOverlaps function, from the Bioconductor package GenomicRanges is used to quantify the reads mapping on mature miRNAs.</p>

<p>All the parameters needed to run the miRNAseq workflow can be setup using 4SeqGUI</p>
<div class="figure">
<img src="../inst/img/mirna2.jpeg" alt="miRNAseq parameters"><p class="caption">miRNAseq parameters</p>
</div>
<p>A detailed description of the parameters is given below.</p>
<div id="mirnaseq-workflow-by-line-command" class="section level3">
<h3 class="hasAnchor">
<a href="#mirnaseq-workflow-by-line-command" class="anchor"></a>miRNAseq workflow by line command</h3>
<p>The miRNAseq workflow can be also executed using R and it is completely embedded in a unique function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.mirnaCounts.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.mirnaCounts.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.mirnaCounts"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/mirnaCounts.html">mirnaCounts</a></span>(<span class="dt">group=</span><span class="st">"docker"</span>,<span class="dt">fastq.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(), <span class="dt">scratch.folder=</span><span class="st">"/data/scratch"</span>, 
            <span class="dt">mirbase.id=</span><span class="st">"hsa"</span>,<span class="dt">download.status=</span><span class="ot">FALSE</span>, <span class="dt">adapter.type=</span><span class="st">"NEB"</span>, <span class="dt">trimmed.fastq=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>User has to create the <strong>fastq.folder</strong>, where the fastq.gz files for all miRNAs under analysis are located. The <strong>scratch.folder</strong> is the location where temporary data are created. The results will be then saved in the <strong>fastq.folder</strong>. Moreover, user has to provide the identifier of the miRBase organism, e.g. <strong>hsa</strong> for Homo sapiens, <strong>mmu</strong> for Mus musculus. If the <strong>download.status</strong> is set to FALSE, mirnaCounts uses miRBase release 21, if it is set to TRUE the lastest version of precursor and mature miRNAs will be downloaded from miRBase. Users need to provide the name of the producer of the miRNA library prep kit to identify which adapters need to be provided to cutadapt, <strong>adapter.type</strong> parameter. The available adapters are NEB and Illumina, but, upon request, we can add other adapters. Finally, if the <strong>trimmed.fastq</strong> is set to FALSE then the trimmed fastq are not saved at the end of the analysis.</p>
</div>
<div id="mirnaseq-workflow-output-files" class="section level3">
<h3 class="hasAnchor">
<a href="#mirnaseq-workflow-output-files" class="anchor"></a>miRNAseq workflow output files</h3>
<p>The miRNAseq workflow produces the following output files:</p>
<pre><code>+ README: A file describing the content of the data folder
+ all.counts.txt: miRNAs raw counts, to be used for differential expression analysis
+ trimmimg.log: adapters trimming statistics
+ shrimp.log: mapping statistics
+ all.counts.Rda: miRNAs raw counts ready to be loaded in R.
+ analysis.log: logs of the full analysis pipeline</code></pre>

</div>
<div id="adding-covariates-and-batches-to-mirnacounts-output-all-counts-txt" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-covariates-and-batches-to-mirnacounts-output-all-counts-txt" class="anchor"></a>Adding covariates and batches to mirnaCounts output: all.counts.txt</h3>
<p><strong>4SeqGUI</strong> provides an interface to add covariates and batches to all.counts.txt</p>
<div class="figure">
<img src="../inst/img/mirna_covars.jpeg" alt="miRNAseq covariates and batches"><p class="caption">miRNAseq covariates and batches</p>
</div>
<p>The function <strong>mirnaCovar</strong> add to the header of all.counts.txt covariates and batches or covariates only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#test example</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.mirna.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.mirna.analysis.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.mirna.analysis"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/mirnaCovar.html">mirnaCovar</a></span>(<span class="dt">experiment.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(), <span class="st">"all.counts.txt"</span>, <span class="dt">sep=</span><span class="st">"/"</span>),
     <span class="dt">covariates=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, <span class="st">"Cov.1"</span>, 
                  <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>, <span class="st">"Cov.2"</span>),
     <span class="dt">batches=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"bath.1"</span>, <span class="st">"bath.1"</span>, <span class="st">"bath.2"</span>, <span class="st">"bath.2"</span>, <span class="st">"batch.1"</span>, <span class="st">"batch.1"</span>, 
               <span class="st">"batch.2"</span>, <span class="st">"batch.2"</span>,<span class="st">"batch.1"</span>, <span class="st">"batch.1"</span>,<span class="st">"bath.2"</span>, <span class="st">"bath.2"</span>), <span class="dt">output.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>())</code></pre></div>
<p>The output of <strong>mirnaCovar</strong>, i.e. w_covar_batch_all.counts.txt, is compliant with PCA, Sample size estimator, Experiment stat. power and DEseq2 analysis.</p>

</div>
</div>
<div id="chipseq-workflow-howto" class="section level2">
<h2 class="hasAnchor">
<a href="#chipseq-workflow-howto" class="anchor"></a>chipseq workflow: HowTo</h2>
<p>The chipseq workflow can be ran using <strong>4SeqGUI</strong> graphical interface:</p>
<div class="figure">
<img src="../inst/img/chipseq0.jpeg" alt="ChIPseq workflow"><p class="caption">ChIPseq workflow</p>
</div>
<p>The ChIPseq consists of two main steps:</p>
<ul>
<li><p>Creating a genome index for BWA (see end of this paragraph)</p></li>
<li><p>Running MACS or SICER analysis</p></li>
</ul>
<div id="creating-a-bwa-index-file-for-chipseq" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-bwa-index-file-for-chipseq" class="anchor"></a>Creating a BWA index file for Chipseq:</h3>
<p>The index can be easily created using the graphical interface:</p>
<div class="figure">
<img src="../inst/img/chipseq1.jpeg" alt="Creating a BWA index with Genome indexing BWA"><p class="caption">Creating a BWA index with Genome indexing BWA</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bwaIndexUcsc.html">bwaIndexUcsc</a></span>(<span class="dt">group=</span><span class="st">"sudo"</span>,<span class="dt">genome.folder=</span><span class="st">"/sto2/data/scratch/mm10bwa"</span>, <span class="dt">uscs.urlgenome=</span>
<span class="st">"http://hgdownload.cse.ucsc.edu/goldenPath/mm10/bigZips/chromFa.tar.gz"</span>,
<span class="dt">gatk=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>In brief, <strong>bwaIndexUcsc</strong> uses UCSC genomic data. User has to provide the URL (<strong>uscs.urlgenome</strong>) for the file chromFa.tar.gz related to the organism of interest and the path to the folder where the index will be generated (<strong>genome.folder</strong>). The parameter <strong>gatk</strong> has to be set to FALSE if it is not required for ChIPseq genomic index creation.</p>
<p>Precompiled index folders are available:</p>
<ul>
<li><a href="http://130.192.119.59/public/mm10bwa.tar.gz">mm10bwa</a></li>
</ul>
</div>
<div id="calling-peaks-and-annotating" class="section level3">
<h3 class="hasAnchor">
<a href="#calling-peaks-and-annotating" class="anchor"></a>Calling peaks and annotating:</h3>
<p>All the parameters needed to run MACS or SICER can be setup using 4SeqGUI</p>
<div class="figure">
<img src="../inst/img/chipseq3.jpeg" alt="MACS and SICER analysis"><p class="caption">MACS and SICER analysis</p>
</div>
<p>A detailed description of the parameters is given below.</p>
</div>
<div id="chipseq-workflow-by-line-command" class="section level3">
<h3 class="hasAnchor">
<a href="#chipseq-workflow-by-line-command" class="anchor"></a>Chipseq workflow by line command</h3>
<p>The chipseq workflow can be also executed using R and it is completely embedded in a unique function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="st">"wget 130.192.119.59/public/test.chipseqCounts.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"test.chipseqCounts.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="st">"test.chipseqCounts"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(docker4seq)
<span class="kw"><a href="../reference/chipseqCounts.html">chipseqCounts</a></span>(<span class="dt">group =</span> <span class="st">"docker"</span>, <span class="dt">output.folder =</span> <span class="st">"./prdm51.igg"</span>,
  <span class="dt">mock.folder=</span><span class="st">"./igg"</span>, <span class="dt">test.folder=</span><span class="st">"./prdm51"</span>, <span class="dt">scratch.folder=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(),
  <span class="dt">adapter5 =</span> <span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,
  <span class="dt">adapter3 =</span> <span class="st">"AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT"</span>,
  <span class="dt">threads =</span> <span class="dv">8</span>, <span class="dt">min.length =</span> <span class="dv">30</span>, genome.folder,
  <span class="dt">mock.id =</span> <span class="st">"igg"</span>, <span class="dt">test.id =</span> <span class="st">"tf"</span>, genome, <span class="dt">read.size =</span> <span class="dv">50</span>,
  <span class="dt">tool =</span> <span class="st">"macs"</span>, <span class="dt">macs.min.mfold =</span> <span class="dv">10</span>, <span class="dt">macs.max.mfold =</span> <span class="dv">30</span>,
  <span class="dt">macs.pval =</span> <span class="st">"1e-5"</span>, <span class="dt">sicer.wsize =</span> <span class="dv">200</span>, <span class="dt">sicer.gsize =</span> <span class="dv">200</span>,
  <span class="dt">sicer.fdr =</span> <span class="fl">0.1</span>, <span class="dt">tss.distance =</span> <span class="dv">0</span>, <span class="dt">max.upstream.distance =</span> <span class="dv">10000</span>,
  <span class="dt">remove.duplicates =</span> <span class="st">"N"</span>)</code></pre></div>
<p>Specifically user needs to create three folders:</p>
<pre><code>+ mock.folder, where the fastq.gz file for the control sample is located. 
  For control sample we refer to ChIP with IgG only or input DNA.
+ test.folder, where the fastq.gz file for the ChIP of the sample to be analysed.
+ output.folder, where the R script embedding the above script is located.</code></pre>
<p>The <strong>scratch.folder</strong> can be the same as the <strong>output.folder</strong>. However, if the system has a high speed disk for temporary calculation, e.g. a SSD disk, the location of the scratch.folder on the SSD will reduce significantly the total execution time.</p>
<p>User needs to provide also the sequencing adapters, i.e. <strong>adapter5</strong> and <strong>adapter3</strong> parameters. In case of Illumina platform the adapters sequences can be easily recovered <a href="https://support.illumina.com/content/dam/illumina-support/documents/documentation/chemistry_documentation/experiment-design/illumina-adapter-sequences_1000000002694-01.pdf">here</a>.</p>
<p><strong>Threads</strong> indicates the max number of cores used by <em>skewer</em> and <em>bwa</em>, all the other steps are done on a single core. The <strong>min.length</strong> refers to the minimal length that a reads should have after adapters trimming. Since today the average read length for a ChIP experiment is 50 or 75 nts we suggest to bring to 40 nts the min.length parameter to increase the precision in assigning the correct position on the genome.</p>
<p>The <strong>genome.folder</strong> parameter refers to the location of the genomic index generated by bwa using the <em>docker4seq</em> function <strong>bwaIndexUcsc</strong>.</p>
<p><strong>mock.id</strong> and <strong>test.id</strong> identify the type of sample and are assigned to the ID parameter in the RG field of the bam file.</p>
<p><strong>genome</strong> is the parameter referring to the annotation used to associate ChIP peaks with genes. In the present implementation hg38, hg19 for human and mm10 and mm9 for mouse annotations are available.</p>
<p><strong>read.size</strong> is a parameter requested by MACS and SICER for their analysis. <strong>macs.min.mfold</strong>, <strong>macs.max.mfold</strong>, <strong>macs.pval</strong> are the default parameters requested to peaks definition for more info please refer to the documentation of MACS 1.4. <strong>sicer.wsize</strong>, <strong>sicer.gsize</strong>, <strong>sicer.fdr</strong> are the default parameters requested to peaks definition for more info please refer to the documentation of SICER 1.1. <strong>IMPORTANT</strong>: The optimal value for <strong>sicer.gsize</strong> in case of H3K4Me3 ChIP is 200 and in case of ChIP H3K27Me3 is 600.</p>
<p><strong>tss.distance</strong> and <strong>max.upstream.distance</strong> are parameters required by ChIPseqAnno, which is the Bioconductor package used to assign the peaks to specific genes. Specifically max.upstream.distance refers to the max distance in nts that allows the association of a peak with a specific gene.</p>
<p><strong>remove.duplicates</strong> is the parameter that indicates if duplicates have to be removed or not. It has two options: <strong>N</strong> duplicates are not removed, <strong>Y</strong> duplicates are removed.</p>
</div>
<div id="chipseq-workflow-output-files" class="section level3">
<h3 class="hasAnchor">
<a href="#chipseq-workflow-output-files" class="anchor"></a>Chipseq workflow output files</h3>
<p>The chipseq workflow produces the following output files:</p>
<pre><code>+ README: A file describing the content of the data folder
+ mypeaks.xls: All detected peaks alongside the nearest gene and its annotation
+ mytreat.counts: The total reads count for the provided treatment file
+ mycontrol.counts: The total reads count for the provided control/background file
+ peak_report.xls: Aggregate information regarding the peak and their position relative to the nearest gene
+ chromosome_distribution.pdf: Barplot of the distribution of the peaks on the chromosomes
+ relative_position_distribution.pdf: Barplot of the distribution of the peaks positions relative to their nearest gene
+ peak_width_distribution.pdf: Histogram of the distribution of the width of the peaks
+ distance_from_nearest_gene_distribution.pdf: Histogram of the distribution of the distance of each peak from its nearest gene
+ cumulative_coverage_total.pdf: Cumulative normalized gene coverage
+ cumulative_coverage_chrN.pdf: Cumulative normalized gene coverage for the specific chromosome
+ mycontrol_sorted.bw: bigWig file for UCSC Genome Browser visualization
+ mytreat_sorted.bw: bigWig file for UCSC Genome Browser visualization
 </code></pre>
</div>
</div>
<div id="tutorials" class="section level2">
<h2 class="hasAnchor">
<a href="#tutorials" class="anchor"></a>Tutorials</h2>
<div id="rnaseq-workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#rnaseq-workflow" class="anchor"></a>RNAseq workflow</h3>
<p><a href="http://130.192.119.59/public/test.mrnaCounts_full.zip"><strong>Tutorial experiment downloadable here</strong></a>:</p>
<pre><code>+ Three replicates for two experimental conditions 

+ single-end mode sequencing 

+ 1 million reads for each sample</code></pre>
<p><strong>Experiment description</strong>:</p>
<pre><code>+ 4T1 mouse cell line grown in standard DMEM medium (e) is compared with the same cells grown in low attachment medium (p)</code></pre>
<p>The following data are available for download:</p>
<ul>
<li>
<p><a href="http://130.192.119.59/public/test.mrnaCounts_full.zip">Fastq files for 3 samples grown in standard DMEM medium (e) and for 3 samples grown in low attachment medium (p) to be used to calculate samples counts</a>.</p>
<ul>
<li><p>This data set allows running all the steps required to detect differentially expressed genes. The first step is the quantification of genes and isoforms via mapping reads to the reference genome via STAR and using this mapping information to quantify genes and transcripts using RSEM, i.e. <em>this section</em>.</p></li>
<li><p>The RSEM counts table, generated for all samples, are combined in a unique table, see <em>From samples to experiment</em> section. This table is used for differential expression genes detection. For visualization purposes log2 FPKM and log2 TPM tables are also generated, see <em>From samples to experiment</em> section. More info on the FPKM and TPM are available <a href="http://www.rna-seqblog.com/rpkm-fpkm-and-tpm-clearly-explained/">here</a>.</p></li>
<li><p>Subsequently the overall characteristics of the dataset can be explore via <a href="https://www.youtube.com/watch?v=BfTMmoDFXyE">PCA</a>, <em>Visualizing experiment data with PCA</em> section.</p></li>
<li><p>It is also possible to evaluate which is the statistical power of the experiment, i.e. identifying the fraction of genes/transcripts that can be identify giving the statistical structure of the experiment, or identify the optimal number of samples required to detect differentially expressed genes. More info in <em>Evaluating sample size and experiment power</em> section.</p></li>
<li><p>Differential expression can be then evaluate using the DESeq2 module, <em>Differential expression analysis with DESeq2</em>.</p></li>
</ul>
</li>
<li>
<p>Furthermore, also intermediate results are provided:</p>
<ul>
<li><p><a href="http://130.192.119.59/public/test.samples2experiment.zip">The counts tables generated by STAR+RSEM analysis to be used to assemble counts, TPM and FPKM experiment tables</a></p></li>
<li><p><a href="http://130.192.119.59/public/test.analysis.zip">The experiment tables that can be used to study samples organization via PCA or the statistical characteristics of the experiment, i.e. the statistical power and the optimal sample size of the experiment</a></p></li>
<li><p>The above data set can be used also to detect differentially expressed genes and isoforms using the DESeq2 module.</p></li>
</ul>
</li>
</ul>
</div>
<div id="mirnaseq-workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#mirnaseq-workflow" class="anchor"></a>miRNAseq workflow</h3>
<p><a href="http://130.192.119.59/public/test.mirnaCounts.zip"><strong>Tutorial experiment downloadable here</strong></a>:</p>
<ul>
<li><p>Six specimens for two experimental conditions</p></li>
<li><p>single-end mode sequencing,</p></li>
<li><p>1 million reads for each sample.</p></li>
</ul>
<p><strong>Experiment description</strong>:</p>
<ul>
<li><p>Six blood circulating exosomes miRNA samples from healthy donors (hd) and six blood circulating exosomes miRNA samples from tumor patients (tum)</p></li>
<li><p>from 1 to 3 hd and tum samples were harvested on day 1, from 5 to 6 hd and tum samples were harvested on day 2. Thus the data are require the addition of the batch effect in differential expression analysis.</p></li>
</ul>
<p>The following data are available for download:</p>
<ul>
<li>
<p><a href="http://130.192.119.59/public/test.mrnaCounts_full.zip">Fastq files for 6 miRNA samples from healthy donors (hd), and six miRNA samples from tumor patients (tum) to be used to calculate samples counts and organize them in a counts table</a>.</p>
<ul>
<li><p>This data set allows running all the steps required to detect differentially expressed genes. The first step is the quantification of mature annotated miRNA and the generation of counts table to be used for differential expression, i.e. <em>this section</em>.</p></li>
<li><p>The covariates and batch effects can be added to the counts table (all.counts.txt), see <em>From samples to experiment</em> section. This table is used for differential expression genes detection.</p></li>
<li><p>Subsequently the overall characteristics of the dataset can be explore via <a href="https://www.youtube.com/watch?v=BfTMmoDFXyE">PCA</a>, <em>Visualizing experiment data with PCA</em> section.</p></li>
<li><p>It is also possible to evaluate which is the statistical power of the experiment, i.e. identifying the fraction of genes/transcripts that can be identify giving the statistical structure of the experiment, or identify the optimal number of samples required to detect differentially expressed genes. More info in <em>Evaluating sample size and experiment power</em> section.</p></li>
<li><p>Differential expression can be then evaluate using the DESeq2 module, <em>Differential expression analysis with DESeq2</em>.</p></li>
</ul>
</li>
</ul>
</div>
<div id="chipseq-workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#chipseq-workflow" class="anchor"></a>ChIPseq workflow</h3>
<p><a href="http://130.192.119.59/public/test.chipseqCounts.zip"><strong>Tutorial experiment downloadable here</strong></a>:</p>
<pre><code>+ Two ChIPseq one IgG control and an other Prdm5 TF moAb (mouse)

+ single-end mode sequencing, 

+ 1 million reads for each sample.</code></pre>
<p><strong>Experiment description</strong>:</p>
<ul>
<li><p>PRDM family members are transcriptional regulators involved in tissue specific differentiation. PRDM5 has been reported to predominantly repress transcription, but a characterization of its molecular functions in a relevant biological context is lacking. Prdm5 controls both Collagen I transcription and fibrillogenesis by binding inside the Col1a1 gene body and maintaining RNA polymerase II occupancy (Galli et al. PLoS Genet. 2012,e1002711).</p></li>
<li><p>The toy experiment is organized in three folders: i. one for IgG (igg, containing the igg pool down fastq); ii. one for Prdm5 (prdm5, containing the Prdm5 pool down fastq) and iii. the other for analysis output prdm5.igg, where MACS results will be located. The execution of the ChIPseq workflow using GUI or line command will provide the final annotated table of peaks (mypeaks.xls)</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#rnaseq-workflow-howto">RNAseq workflow: Howto</a></li>
      <li><a href="#mirnaseq-workflow-howto">miRNAseq workflow: Howto</a></li>
      <li><a href="#chipseq-workflow-howto">chipseq workflow: HowTo</a></li>
      <li><a href="#tutorials">Tutorials</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Raffaele Calogero, Neha Kulkarni, Luca Alessandri, Marco Beccuti, Greta Romano, Francesca Cordero.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
